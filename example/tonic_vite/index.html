<html>

<head>
</head>

<body>
  <script type="module">
    import { Elm } from './src/Main.elm';
    import './src/main.css';

    if (__DEV__) {
      await import('./generated/Proto/dev-tools.mjs').then(() => console.warn('Grpc Dev Tools enabled.'));
    }

    const USER_ID_KEY = "current_user_id";

    const userId = window.sessionStorage.getItem(USER_ID_KEY);
    const now = new Date().getTime();

    const app = Elm.Main.init({
      flags: { userId, now },
    });

    app.ports.setOrDeleteUserId.subscribe(newUserId => {
      if (newUserId) {
        window.sessionStorage.setItem(USER_ID_KEY, newUserId);
      } else {
        window.sessionStorage.removeItem(USER_ID_KEY);
      }
    });
  </script>
</body>

</html>